{% extends "base.html" %}
{% block content %}

<style>
    body {
        background: #ece5dd;
    }

    .chat-wrapper {
        max-width: 950px;
        margin: auto;
        background: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, .1);
    }

    /* HEADER */
    .chat-header {
        background: #075e54;
        color: white;
        padding: 12px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-header h6 {
        margin: 0;
        font-weight: 600;
    }

    .chat-header small {
        opacity: .9;
    }

    /* CHAT AREA */
    .chat-box {
        background: #e5ddd5;
        height: 450px;
        overflow-y: auto;
        padding: 15px;
    }

    .chat {
        display: flex;
        margin-bottom: 10px;
    }

    .chat.student {
        justify-content: flex-start;
    }

    .chat.admin {
        justify-content: flex-end;
    }

    .bubble {
        max-width: 70%;
        padding: 10px 14px;
        border-radius: 10px;
        position: relative;
        font-size: 14px;
        line-height: 1.4;
    }

    .student .bubble {
        background: #ffffff;
        border-top-left-radius: 0;
    }

    .admin .bubble {
        background: #dcf8c6;
        border-top-right-radius: 0;
    }

    .time {
        font-size: 11px;
        color: gray;
        text-align: right;
        margin-top: 4px;
    }

    /* INPUT AREA */
    .chat-input {
        background: #f0f0f0;
        padding: 10px;
        border-top: 1px solid #ddd;
    }

    .chat-input form {
        display: flex;
        gap: 8px;
    }

    .chat-input input {
        flex: 1;
        border-radius: 20px;
        padding: 10px 15px;
    }

    .chat-input button {
        border-radius: 50%;
        width: 42px;
        height: 42px;
    }
</style>

<div class="chat-wrapper">

    <!-- HEADER -->
    <div class="chat-header">
        <div>
            <h6>{{ student.name }}</h6>
            <small>
                Semester {{ student.semester }} |
                Reg {{ student.registration_no }}
            </small>
        </div>
        <span>ðŸŸ¢ Online</span>
    </div>

    <!-- CHAT BODY -->
    <div class="chat-box" id="chatBox">
        {% if messages %}
        {% for m in messages %}
        <div class="chat {{ m.sender }}">
            <div class="bubble">
                {{ m.message }}
                <div class="time">
                    {{ m.created_at }}
                    {% if m.sender == 'student' %}
                    {% if m.seen == 1 %}
                    âœ”âœ”
                    {% else %}
                    âœ”
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-center text-muted mt-4">
            No messages yet
        </p>
        {% endif %}
    </div>

    <!-- INPUT -->
    <div class="chat-input">
        <form method="POST" action="{{ url_for('admin_support_reply', student_id=student_id) }}">
            <input type="text" name="reply" class="form-control" placeholder="Type a message..." required>
            <button class="btn btn-success">
                âž¤
            </button>
        </form>
    </div>

</div>

<script>
    // Auto scroll to bottom
    const chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;
</script>

{% endblock %}