{% extends "base.html" %}
{% block content %}

<style>
    .chat-box {
        background: #e5ddd5;
        padding: 15px;
        border-radius: 10px;
        height: 420px;
        overflow-y: auto;
    }

    .chat.student {
        text-align: left;
        margin-bottom: 10px;
    }

    .chat.admin {
        text-align: right;
        margin-bottom: 10px;
    }

    .bubble {
        display: inline-block;
        padding: 10px 14px;
        border-radius: 10px;
        max-width: 70%;
    }

    .student .bubble {
        background: #ffffff;
    }

    .admin .bubble {
        background: #dcf8c6;
    }

    .time {
        font-size: 12px;
        color: gray;
    }
</style>

<div class="container">

    <h5 class="fw-bold mb-3">
        {{ student.name }} |
        Semester {{ student.semester }} |
        Reg {{ student.registration_no }}
    </h5>

    <div class="chat-box mb-3">
        {% if messages %}
        {% for m in messages %}
        <div class="chat student">
            <div class="bubble">
                {{ m.content }}
                <div class="time">{{ m.created_at }}</div>
            </div>
        </div>

        {% if m.reply %}
        <div class="chat admin">
            <div class="bubble">
                {{ m.reply }}
                <div class="time">Seen ✔✔</div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% else %}
        <p class="text-muted text-center">No messages yet.</p>
        {% endif %}
    </div>

    <!-- ✅ SINGLE REPLY BOX -->
    <form method="POST" action="{{ url_for('admin_support_reply', student_id=student_id) }}">
        <div class="input-group">
            <input type="text" name="reply" class="form-control" placeholder="Type reply..." required>
            <button class="btn btn-success">
                Send
            </button>
        </div>
    </form>

</div>

{% endblock %}